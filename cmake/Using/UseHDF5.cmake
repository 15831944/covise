MACRO(USE_HDF5)
  IF (UNIX)
    FIND_PACKAGE(HDF5 COMPONENTS C HL CXX)
    IF (NOT HDF5_CXX_LIBRARIES)
      SET(HDF5_FOUND FALSE)
      USING_MESSAGE("Skipping because of missing HDF5_CXX_LIBRARIES")
    ENDIF()
    IF (NOT HDF5_HL_LIBRARIES)
      SET(HDF5_FOUND FALSE)
      USING_MESSAGE("Skipping because of missing HDF5_HL_LIBRARIES")
    ENDIF()
  ELSE()
    FIND_PACKAGE(HDF5 COMPONENTS C CXX HL CXX_HL static)
  ENDIF()
  IF ((NOT HDF5_FOUND) AND (${ARGC} LESS 1))
      USING_MESSAGE("Skipping because of missing HDF5")
    RETURN()
  ENDIF((NOT HDF5_FOUND) AND (${ARGC} LESS 1))
  IF(NOT HDF5_USED AND HDF5_FOUND)
    SET(HDF5_USED TRUE)
    INCLUDE_DIRECTORIES(${HDF5_INCLUDE_DIR})
    SET(EXTRA_LIBS ${EXTRA_LIBS} ${HDF5_LIBRARIES} ${HDF5_HL_LIBRARIES})
  ENDIF()
ENDMACRO(USE_HDF5)

